---
import Layout from '@layouts/Layout.astro';
import SectionTitle from '@components/SectionTitle.astro';
import ShowHtml from '../components/ShowHtml.jsx';

// 投稿タイプ
const postTypeInfo = 'works';
// // 1ページの表示最大数
// const perPageInfo = 10;

// 取得するのは最初の1ページ
const worksRes = await fetch(`https://itouke.wpx.jp/tw-wordpress/wp-json/wp/v2/${postTypeInfo}?orderby=date&order=desc`);

// レスポンスヘッダーから合計記事数を取得
// 取得したデータをjsonに変換
const worksPosts = await worksRes.json();
---

<Layout title="Take's Portfolio" description="Webコーダーたけみょんのポートフォリオサイトです。">
	<main class="w-[100%] mt-[50px] md:mt-[80px]">
		<div class="fv max-w-[440px] md:max-w-[1024px] w-[100%] px-[16px] md:px-[40px] flex flex-col md:flex-row justify-center items-start md:items-center gap-[16px] md:gap-[48px] mx-auto">
			<div class="fv__text-content inline-block max-w-[240px] md:max-w-[360px] w-[100%] z-[100] p-[16px] md:p-[30px] shadow-xl rounded-[16px] md:rounded-[30px] bg-white flex-shrink-0">
				<h2 id="ease-in" class="text-[24px] md:text-[36px] fv__title relative flex justify-start items-center gap-[0.2px] font-bold">Take's&nbsp;Portfolio</h2>
				<div id="title" class="fv__text-wrapper">
					<p id="upper-text" class="fv__text--upper text-[12px] md:text-[18px] flex justify-start items-center gap-[0.2px]">Webサイトからサーバーまで。</p>
					<p id="middle-text" class="fv__text--middle text-[12px] md:text-[18px] flex justify-start items-center gap-[0.2px]">広い視点でお悩み解決いたします。</p>
				</div>
			</div>
			<!-- FV swiper -->
			<!-- Slider main container -->
			<div class="swiper fv__slider max-w-[300px] max-h-[157.5px] md:max-w-[750px] md:max-h-[393.75px] md:min-w-[400px] md:min-h-[210px] w-[83.2vw] h-[43.75vw] mt-[-60px] md:mt-0 ml-0 md:!ml-[clamp(-25rem,-35.4167rem+21.7014vw,-9.375rem)] flex-shrink-0" id="js-fv-slider">
				<!-- Additional required wrapper -->
				<div class="swiper-wrapper fv__slides max-w-[300px] mx-auto max-h-[157.5px] md:max-w-[750px] md:max-h-[393.75px] md:min-w-[400px] md:min-h-[210px] w-[83.2vw] h-[43.75vw] transition !ease-linear">
						<!-- Slides -->
						{worksPosts.map((works: any) => (
							<div class="swiper-slide fv__slide min-w-[300px] min-h-[157.5px] md:min-w-[400px] md:max-w-[750px] md:max-h-[393.75px] md:min-h-[210px] w-[83.2vw] h-[43.75vw]">
								<img class="max-w-[300px] max-h-[157.5px] md:min-w-[400px] md:min-h-[210px] md:max-w-[750px] md:max-h-[393.75px] w-[83.2vw] h-[43.75vw] object-cover aspect-[1200/630]" src={works.works_customFields.works_thumbnail[0]} alt={works.works_customFields.works_title[0]}/>
							</div>
						))}
				</div>
			</div>
		</div>

		<section id="about" class="about max-w-[440px] md:max-w-[1024px] w-[100%] mx-auto pt-[60px] md:pt-[120px]">
			<div class="about__inner w-[100%] px-[20px] md:px-[40px] mx-auto">
				<SectionTitle title='― About' description='たけみょんについて' />
				<div class="about__contents flex flex-col-reverse md:flex-row justify-center items-start gap-[40px] mt-[32px]">
					<div class="about__left-contents">
						<div class="about__sp-upper-contents flex gap-[16px]">
							<p class="about__text about__sp-upper-text text-[14px] md:text-[16px]">
								サーバーエンジニア(インフラ系)から転身したWebエンジニア。<br />
								Webサイトの制作からサーバーの構築まで幅広く対応いたします。<br />
								日々チャーハン(概念)を食べて生きている。
							</p>
							<div class="about__sp-upper-image flex-shrink-0 md:hidden mx-auto">
								<img class="max-w-[150px] w-[100%]" src="/images/take_icon.jpg" alt="たけみょんの写真" />
							</div>
						</div>
						<div class="about__profile flex flex-col gap-[12px]">
							<dl class="flex gap-[8px] md:gap-[16px] mt-[16px] flex-col md:flex-row">
								<dt class="about__term min-w-[90px] text-[14px] md:text-[16px] font-bold">Name:</dt>
								<dd class="about__description text-[14px] md:text-[16px]">たけみょん</dd>
							</dl>
							<dl class="flex gap-[8px] md:gap-[16px] flex-col md:flex-row">
								<dt class="about__term min-w-[90px] text-[14px] md:text-[16px] font-bold">Job:</dt>
								<dd class="about__description text-[14px] md:text-[16px]">フロントエンドエンジニア・サーバーエンジニア</dd>
							</dl>
							<dl class="flex gap-[8px] md:gap-[16px] flex-col md:flex-row">
								<dt class="about__term min-w-[90px] text-[14px] md:text-[16px] font-bold">Location:</dt>
								<dd class="about__description text-[14px] md:text-[16px]">大阪の刃物の町</dd>
							</dl>
							<dl class="flex gap-[8px] md:gap-[16px] flex-col md:flex-row">
								<dt class="about__term min-w-[90px] text-[14px] md:text-[16px] font-bold">Skill:</dt>
								<dd class="about__description text-[14px] md:text-[16px]">HTML / CSS(Sass・Tailwind CSS) / PHP / WordPress / Astro</dd>
							</dl>
							<dl class="flex gap-[8px] md:gap-[16px] flex-col md:flex-row">
								<dt class="about__term min-w-[90px] text-[14px] md:text-[16px] font-bold">Certifying:</dt>
								<dd class="about__description text-[14px] md:text-[16px]">基本情報技術者・CompTIA A+/Network+/Server+</dd>
							</dl>
						</div>
					</div>
					<div class="about__right-contents flex-shrink-0 mx-auto hidden md:block">
						<img class="max-w-[250px] w-[100%]" src="/images/take_icon.jpg" alt="たけみょんの写真" />
					</div>
				</div>
			</div>
		</section>

		<section id="works" class="works max-w-[440px] md:max-w-[1024px] w-[100%] mx-auto pt-[60px] md:pt-[120px]">
			<div class="works__inner px-[20px] md:px-[40px] w-[100%] mx-auto">
				<SectionTitle title='― Works' description='制作実績' />
			</div>
		</section>
		<div class="swiper works__slider works-slider !px-[20px] w-[100%] max-w-[440px] md:max-w-[100%] h-[300px] md:h-[350px] mt-[32px] hidden md:block">
			<ul class="swiper-wrapper works__slides works__list w-[100%]">
				{worksPosts.map((works: any, index: any) => (
					<li class="swiper-slide works__slide works__item" id={index}>
						<div class="works__thumbnail max-w-[500px]">
							<img class="shadow-xl aspect-[1200/630]" src={works.works_customFields.works_thumbnail[0]} alt={works.works_customFields.works_title[0]} />
						</div>
						<div class="works__content">
							<h3 class="works__title text-[14px] md:text-[16px]">{works.works_customFields.works_title[0]}</h3>
						</div>
					</li>
				))}
			</ul>
			<div class="works-slider__buttons absolute bottom-[0] max-w-[440px] md:max-w-[1024px] px-[16px] h-[80px] md:px-[40px] w-[100%] left-[50%] transform -translate-x-[50%] z-[100]">
				<!-- 戻る・進むボタン -->
				<div class="swiper-button-prev works-slider__prev-button mt-[120px] md:mt-[420px]"></div>
				<div class="swiper-button-next works-slider__next-button mt-[120px] md:mt-[420px]"></div>
			</div>
		</div>

		<section id="work-flow" class="work-flow max-w-[440px] md:max-w-[1024px] w-[100%] mx-auto pt-[60px] md:pt-[120px]">
			<div class="work-flow__inner px-[20px] md:px-[40px] w-[100%] mx-auto">
				<SectionTitle title='― Work Flow' description='お仕事の流れ' />
				<p class="mt-[32px]">
					以下は大まかなお仕事の流れです。詳細はお気軽にご相談ください。
				</p>
				<ul class="mt-[56px] flex flex-wrap justify-center items-center gap-[8px]">
					<li class="relative flex flex-col justify-center items-center gap-[12px] pt-[48px] p-[16px] w-[230px] border border-[#888] rounded-[8px]">
						<span class="absolute pt-[2px] text-[32px] text-[#fff] bg-[#888] w-[48px] h-[48px] text-center top-[-24px] rounded-[4px]">
							1
						</span>
						<figure class="flex flex-col justify-center items-center gap-[8px]">
							<img class="h-[69px] aspect-[49/66]" src="/images/img_flow1.svg" alt="ご相談・お見積り" width="49" height="66" />
							<figcaption class="font-bold text-[18px]">ご相談・お見積り</figcaption>
						</figure>
						<p>
							要件や納期、予算などお気軽にご相談ください。<br />
							対応内容に応じてお見積りをお送りいたします。
						</p>
					</li>
					<li class="relative flex flex-col justify-center items-center gap-[12px] pt-[48px] p-[16px] w-[230px] border border-[#888] rounded-[8px]">
						<span class="absolute pt-[2px] text-[32px] text-[#fff] bg-[#888] w-[48px] h-[48px] text-center top-[-24px] rounded-[4px]">
							2
						</span>
						<figure class="flex flex-col justify-center items-center gap-[8px]">
							<img class="h-[69px] aspect-[86/69]" src="/images/img_flow2.svg" alt="コーディング" width="86" height="69" />
							<figcaption class="font-bold text-[18px]">コーディング</figcaption>
						</figure>
						<p>
							デザインカンプを元にコーディングを行います。<br />
							コーディング後は品質チェックを行い調整します。
						</p>
					</li>
					<li class="relative flex flex-col justify-center items-center gap-[12px] pt-[48px] p-[16px] w-[230px] border border-[#888] rounded-[8px]">
						<span class="absolute pt-[2px] text-[32px] text-[#fff] bg-[#888] w-[48px] h-[48px] text-center top-[-24px] rounded-[4px]">
							3
						</span>
						<figure class="flex flex-col justify-center items-center gap-[8px]">
							<img class="h-[69px] aspect-[66/66]" src="/images/img_flow3.svg" alt="確認" width="66" height="66" />
							<figcaption class="font-bold text-[18px]">確認</figcaption>
						</figure>
						<p>
							お客様にコーディングしたサイトをご確認頂きます。<br />
							不足部分の修正と対応を行います。
						</p>
					</li>
					<li class="relative flex flex-col justify-center items-center gap-[12px] pt-[48px] p-[16px] w-[230px] border border-[#888] rounded-[8px]">
						<span class="absolute pt-[2px] text-[32px] text-[#fff] bg-[#888] w-[48px] h-[48px] text-center top-[-24px] rounded-[4px]">
							4
						</span>
						<figure class="flex flex-col justify-center items-center gap-[8px]">
							<img class="h-[69px] aspect-[64/64]" src="/images/img_flow4.svg" alt="納品" width="64" height="64" />
							<figcaption class="font-bold text-[18px]">納品</figcaption>
						</figure>
						<p>
							コーディング後のファイル一式を納品いたします。<br />
							本番サーバーへのアップロードも対応可能です。
						</p>
					</li>
				</ul>
			</div>
		</section>

		<section id="contact" class="contact max-w-[440px] md:max-w-[1024px] w-[100%] mx-auto pt-[60px] md:pt-[120px]">
			<div class="contact__inner px-[20px] md:px-[40px] w-[100%] mx-auto">
				<SectionTitle title='― Contact' description='お問い合わせはこちらからお願いします。' />
			</div>
		</section>
	</main>
	<!-- 下記はテンプレート。カスタムフィールド全体取得する -->
	<!-- {worksPosts.map((works: any) => (
		<li class="works__item">
			<div class="works__thumbnail">
				<img src={works.works_customFields.works_thumbnail[0]} alt={works.works_customFields.works_title[0]} />
			</div>
			<div class="works__content">
				<h3 class="works__title">{works.works_customFields.works_title[0]}</h3>
				<p class="works__time">{works.works_customFields.works_time[0]}</p>
				<div class="works__detail">
					<ShowHtml html={works.works_customFields.works_detail[0]} />
				</div>
				<a href={works.works_customFields.works_url[0]} class="works__link">{works.works_customFields.works_url[0]} </a>
			</div>
		</li>
	))} -->

</Layout>

<style is:inline>

	/* .fv__slider {
		margin-top: -40px;
	}

	@media screen and (min-width: 768px) {
		.fv__slider {
			margin-top: initial;
			margin-left: -150px;
		}
		.fv__text-content {
		}
	} */

	.swiper-slide img {
		user-drag: none;
		-webkit-user-drag: none;
		-moz-user-select: none;
	}

	.works__detail h2 {
		font-size: 20px;
		font-weight: bold;
	}

	.fv__slide + .swiper-slide-next {
		opacity: 0;
	}
</style>

<script is:inline>

	document.addEventListener( "astro:page-load", () => {

		// 対象の要素を取得
		const paragraphs = document.querySelectorAll(".fv__title, .fv__text--upper, .fv__text--middle");

		// 各要素に対して処理を行う
		paragraphs.forEach((paragraph) => {
			// テキストコンテンツを取得
			const textContent = paragraph.textContent;
			// テキストコンテンツを一文字ずつ分割して<span>タグで囲んで新しい文字列を作成
			const newTextContent = [...textContent]
				.map((char) => `<span>${char}</span>`)
				.join("");
			// 新しい文字列をHTMLに挿入
			paragraph.innerHTML = newTextContent;
		});

		gsap.fromTo(
			".fv__title span", // アニメーションさせる要素
			{
				autoAlpha: 0, // アニメーション開始前は透明
				y: 20, // 20px下に移動
			},
			{
				autoAlpha: 1, // アニメーション後は出現(透過率0)
				y: 0, // 20px上に移動
				stagger: 0.15, // 0.2秒遅れて順番に再生
			}
		);

		gsap.fromTo(
			".fv__text--upper span", // アニメーションさせる要素
			{
				delay: 3,
				autoAlpha: 0, // アニメーション開始前は透明
				y: 20, // 20px下に移動
			},
			{
				delay: 3,
				autoAlpha: 1, // アニメーション後は出現(透過率0)
				y: 0, // 20px上に移動
				stagger: 0.15, // 0.2秒遅れて順番に再生
			}
		);

		gsap.fromTo(
			".fv__text--middle span", // アニメーションさせる要素
			{
				delay: 6,
				autoAlpha: 0, // アニメーション開始前は透明
				y: 20, // 20px下に移動
			},
			{
				delay: 6,
				autoAlpha: 1, // アニメーション後は出現(透過率0)
				y: 0, // 20px上に移動
				stagger: 0.15, // 0.2秒遅れて順番に再生
			}
		);
	});
</script>

<script>
import Swiper from 'swiper/bundle';
	import 'swiper/css/bundle';

	// Swiperの設定
	const fvSwiperConfig = {
		loop: true,
		speed: 4000,
		allowTouchMove: false,
		autoplay: {
			delay: 0,
			disableOnInteraction: false,
		},
		effect: 'cube',
		centeredSlides: true,
		slidesPerView: 2.5,
		spaceBetween: 0,
	};

	document.addEventListener('DOMContentLoaded', () => {
		new Swiper('.fv__slider', fvSwiperConfig);
	});

	// Swiperの設定
	const worksSwiperConfig = {
		loop: true,
		speed: 500,
		// autoplay: {
		// 	delay: 0,
		// 	disableOnInteraction: false,
		// },
		effect: 'slide',
		centeredSlides: true,
		slidesPerView: 1,
		spaceBetween: 60,
		navigation: {
			nextEl: ".swiper-button-next",
			prevEl: ".swiper-button-prev",
	  },
		breakpoints: {
			768: {
				spaceBetween: 32,
				slidesPerView: 2.2,
			},
			1024: {
				spaceBetween: 32,
				slidesPerView: 3,
			},
			1100: {
				spaceBetween: 64,
				slidesPerView: 3,
			},
		}
	};

	document.addEventListener('DOMContentLoaded', () => {
		new Swiper('.works__slider', worksSwiperConfig);
	});

</script>